import os
from poja.utils import remove_some_lines_in_file_if_exists


def set_no_bucket(temp):
    remove_unnecessary_files(temp)
    apply_modifs_on_files(temp)


def remove_unnecessary_files(temp):
    os.remove(f"{temp}/.github/workflows/cd-storage-bucket.yml")
    os.remove(f"{temp}/cf-stacks/storage-bucket-stack.yml")
    os.remove(f"{temp}/src/main/java/school/hei/poja/file/BucketComponent.java")
    os.remove(f"{temp}/src/main/java/school/hei/poja/file/BucketConf.java")
    os.remove(
        f"{temp}/src/main/java/school/hei/poja/endpoint/rest/controller/health/HealthBucketController.java"
    )


def apply_modifs_on_files(temp):
    remove_some_lines_in_file_if_exists(
        f"{temp}/.github/workflows/cd-compute.yml",
        "health-check-infra:",
        "secrets: inherit",
        False,
    )
    remove_some_lines_in_file_if_exists(
        f"{temp}/.github/workflows/health-check-infra.yml",
        "check-bucket",
        "/health/bucket",
        False,
    )
    remove_some_lines_in_file_if_exists(
        f"{temp}/build.gradle",
        "awssdk:s3:2",
        "s3-transfer-manager",
        False,
    )
    remove_some_lines_in_file_if_exists(
        f"{temp}/template.yml",
        "AWS_S3_BUCKET",
        "AWS_S3_BUCKET",
        False,
    )
